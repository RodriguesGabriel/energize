import json
from typing import TYPE_CHECKING, Any, Dict, List, Optional, Tuple

from torch.utils.data import DataLoader, Subset

from energize.misc.enums import Device, FitnessMetricName
from energize.networks.torch.dataset_loader import DatasetType
from energize.networks.torch.evaluators import BaseEvaluator, LegacyEvaluator
from energize.networks.torch.transformers import (BaseTransformer,
                                                  LegacyTransformer)
from energize.misc.power import PowerConfig
from energize.misc.persistence import Encoder

def main(title, phenotype):
    train_transformer = LegacyTransformer({
        "resize": {
            "size": 32
        }
    })
    test_transformer = LegacyTransformer({
        "resize": {
            "size": 32
        }
    })

    evaluator = LegacyEvaluator(
        "cifar10", FitnessMetricName.POWER, None, None, None, 0, Device.GPU, PowerConfig({
            "measure_power": {
                "train": True,
                "test": True,
                "num_measurements_test": 30,
                "modules": True
            },
            "model_partition": False,
            "model_partition_n": 1,
            "ensure_gpu_exclusivity": False
    }), train_transformer, test_transformer, {
            DatasetType.EVO_TRAIN: 0.7,
            DatasetType.EVO_VALIDATION: 0.2,
            DatasetType.EVO_TEST: 0.1
        })

    metrics = evaluator.evaluate(phenotype, True, 'train_pheno_sandbox', None, False, 10**10, 0)
    print(metrics)
    with open(f"train_pheno_sandbox/results/{title}.json", "w") as f:
        json.dump(dict(zip(metrics.list_fields(), metrics)), f, indent=2, cls=Encoder)

if __name__ == '__main__':
    # zico_best_phenotype = "layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:-1 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:0 layer:conv out_channels:173 kernel_size:4 stride:2 padding:same act:linear bias:False input:1 layer:conv out_channels:37 kernel_size:3 stride:3 padding:valid act:sigmoid bias:False input:2 layer:batch_norm input:3 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:4 layer:conv out_channels:173 kernel_size:4 stride:2 padding:same act:linear bias:False input:5 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:6 layer:conv out_channels:186 kernel_size:3 stride:1 padding:valid act:linear bias:False input:7 layer:conv out_channels:215 kernel_size:4 stride:1 padding:same act:sigmoid bias:False input:8 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:9 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:10 layer:pool_max kernel_size:3 stride:1 padding:valid input:11 layer:conv out_channels:43 kernel_size:4 stride:1 padding:valid act:relu bias:False input:12 layer:fc act:sigmoid out_features:2010 bias:True input:13 layer:fc act:linear out_features:1923 bias:True input:14 layer:fc act:sigmoid out_features:730 bias:False input:15 layer:fc act:linear out_features:1177 bias:False input:16 layer:fc act:sigmoid out_features:320 bias:True input:17 layer:fc act:linear out_features:304 bias:True input:18 layer:fc act:sigmoid out_features:1294 bias:False input:19 layer:fc act:relu out_features:652 bias:True input:20 layer:fc act:sigmoid out_features:1527 bias:True input:21 layer:fc act:sigmoid out_features:1075 bias:False input:22 layer:fc act:relu out_features:2011 bias:False input:23 layer:fc act:linear out_features:1584 bias:True input:24 layer:fc act:linear out_features:304 bias:True input:25 layer:fc act:sigmoid out_features:1983 bias:False input:26 layer:fc act:linear out_features:1747 bias:True input:27 layer:fc act:sigmoid out_features:801 bias:True input:28 layer:fc act:relu out_features:1262 bias:True input:29 layer:fc act:linear out_features:983 bias:False input:30 layer:fc act:relu out_features:1935 bias:False input:31 layer:fc act:sigmoid out_features:972 bias:False input:32 layer:fc act:linear out_features:983 bias:False input:33 layer:fc act:sigmoid out_features:1983 bias:False input:34 layer:fc act:sigmoid out_features:972 bias:False input:35 layer:fc act:linear out_features:878 bias:True input:36 layer:fc act:sigmoid out_features:1527 bias:True input:37 layer:fc act:softmax out_features:10 bias:True input:38 learning:adam lr:0.0708695343781209 beta1:0.9678288144050302 beta2:0.9819584650710927 weight_decay:0.0008371888187699145 early_stop:10 batch_size:762 epochs:10000"
    # zico_best_phenotype_learning = "layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:-1 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:0 layer:conv out_channels:173 kernel_size:4 stride:2 padding:same act:linear bias:False input:1 layer:conv out_channels:37 kernel_size:3 stride:3 padding:valid act:sigmoid bias:False input:2 layer:batch_norm input:3 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:4 layer:conv out_channels:173 kernel_size:4 stride:2 padding:same act:linear bias:False input:5 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:6 layer:conv out_channels:186 kernel_size:3 stride:1 padding:valid act:linear bias:False input:7 layer:conv out_channels:215 kernel_size:4 stride:1 padding:same act:sigmoid bias:False input:8 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:9 layer:conv out_channels:233 kernel_size:3 stride:2 padding:same act:linear bias:False input:10 layer:pool_max kernel_size:3 stride:1 padding:valid input:11 layer:conv out_channels:43 kernel_size:4 stride:1 padding:valid act:relu bias:False input:12 layer:fc act:sigmoid out_features:2010 bias:True input:13 layer:fc act:linear out_features:1923 bias:True input:14 layer:fc act:sigmoid out_features:730 bias:False input:15 layer:fc act:linear out_features:1177 bias:False input:16 layer:fc act:sigmoid out_features:320 bias:True input:17 layer:fc act:linear out_features:304 bias:True input:18 layer:fc act:sigmoid out_features:1294 bias:False input:19 layer:fc act:relu out_features:652 bias:True input:20 layer:fc act:sigmoid out_features:1527 bias:True input:21 layer:fc act:sigmoid out_features:1075 bias:False input:22 layer:fc act:relu out_features:2011 bias:False input:23 layer:fc act:linear out_features:1584 bias:True input:24 layer:fc act:linear out_features:304 bias:True input:25 layer:fc act:sigmoid out_features:1983 bias:False input:26 layer:fc act:linear out_features:1747 bias:True input:27 layer:fc act:sigmoid out_features:801 bias:True input:28 layer:fc act:relu out_features:1262 bias:True input:29 layer:fc act:linear out_features:983 bias:False input:30 layer:fc act:relu out_features:1935 bias:False input:31 layer:fc act:sigmoid out_features:972 bias:False input:32 layer:fc act:linear out_features:983 bias:False input:33 layer:fc act:sigmoid out_features:1983 bias:False input:34 layer:fc act:sigmoid out_features:972 bias:False input:35 layer:fc act:linear out_features:878 bias:True input:36 layer:fc act:sigmoid out_features:1527 bias:True input:37 layer:fc act:softmax out_features:10 bias:True input:38 learning:gradient_descent lr:0.01429129078364156 momentum:0.7816608294630479 weight_decay:0.0008029957322803318 nesterov:True early_stop:18 batch_size:491 epochs:10000"

    # ### 10% train dataset
    # # obtained 0.851 accuracy, used 75.890 W
    # run_1_gen_129_best = "layer:conv out_channels:128 kernel_size:5 stride:3 padding:valid act:relu bias:False input:-1 layer:dropout rate:0.4393157956206536 input:0 layer:batch_norm input:1 layer:batch_norm input:2 layer:fc act:softmax out_features:10 bias:True input:3 learning:adam lr:0.002426340130742103 beta1:0.7071708169676688 beta2:0.6391056369884633 weight_decay:0.0007540343258142589 early_stop:20 batch_size:865 epochs:10000 model_partition:_ partition_point:2"
    # main(run_1_gen_129_best)
    # # obtained 0.885 accuracy, used 131.301 W
    # run_2_gen_149_best = "layer:conv out_channels:114 kernel_size:4 stride:1 padding:valid act:relu bias:False input:-1 layer:conv out_channels:45 kernel_size:4 stride:1 padding:same act:relu bias:False input:0 layer:pool_max kernel_size:2 stride:1 padding:valid input:1 layer:batch_norm input:2 layer:pool_avg kernel_size:2 stride:3 padding:same input:3 layer:dropout rate:0.01767512069866841 input:4 layer:dropout rate:0.22408157576917018 input:5 layer:pool_avg kernel_size:2 stride:3 padding:same input:6 layer:conv out_channels:109 kernel_size:5 stride:3 padding:valid act:relu bias:False input:7 layer:batch_norm input:8 layer:batch_norm input:9 layer:dropout rate:0.3676570593868368 input:10 layer:batch_norm input:11 layer:batch_norm input:12 layer:fc act:softmax out_features:10 bias:True input:13 learning:gradient_descent lr:0.03985358463448746 momentum:0.8339233621930295 weight_decay:0.00041283806108248977 nesterov:False early_stop:16 batch_size:402 epochs:10000 model_partition:_ partition_point:5"
    # main(run_2_gen_149_best)
    # # obtained 0.823 accuracy, used 85.305 W
    # run_3_gen_88_best = "layer:batch_norm input:-1 layer:batch_norm input:0 layer:fc act:softmax out_features:10 bias:True input:1 learning:gradient_descent lr:0.010795885564302634 momentum:0.7366071392247187 weight_decay:0.00034591644169590705 nesterov:False early_stop:5 batch_size:33 epochs:10000 model_partition:_ partition_point:0"    
    # main(run_2_gen_149_best)
    
    # evozero_phenotype_gen24 = "layer:pool_max kernel_size:3 stride:3 padding:same input:-1 layer:pool_avg kernel_size:5 stride:3 padding:same input:0 layer:pool_max kernel_size:3 stride:3 padding:same input:1 layer:fc act:softmax out_features:10 bias:True input:2 learning:lars lr_weights:0.285004723132393 lr_biases:0.004788268112881683 momentum:0.7376078609502625 weight_decay:3.893890642081336e-06 early_stop:20 batch_size:10 epochs:10000"
    custom_learning = "learning:adam lr:0.001 beta1:0.9 beta2:0.999 weight_decay:0.00000001 early_stop:20 batch_size:64 epochs:10000"
    nats_bench_learning = "learning:gradient_descent lr:0.1 momentum:0.9 weight_decay:0.0005 nesterov:True early_stop:20 batch_size:256 epochs:10000"

    # evozero_phenotype_gen24_opt = f"layer:pool_max kernel_size:3 stride:3 padding:same input:-1 layer:pool_avg kernel_size:5 stride:3 padding:same input:0 layer:pool_max kernel_size:3 stride:3 padding:same input:1 layer:fc act:softmax out_features:10 bias:True input:2 {custom_learning}"

    # evozero_model3_gen134 = f"layer:conv out_channels:209 kernel_size:3 stride:1 padding:same act:linear bias:False input:-1 layer:pool_max kernel_size:2 stride:2 padding:same input:0 layer:conv out_channels:230 kernel_size:2 stride:2 padding:same act:linear bias:False input:1 layer:pool_max kernel_size:2 stride:3 padding:same input:2 layer:dropout rate:0.45469315323939513 input:3 layer:conv out_channels:245 kernel_size:5 stride:2 padding:same act:relu bias:False input:4 layer:dropout rate:0.11000394586905969 input:5 layer:fc act:softmax out_features:10 bias:True input:6 {custom_learning}"

    # evozero_model3_gen149_classification_only = f"layer:fc act:linear out_features:181 bias:True input:-1 layer:fc act:linear out_features:1942 bias:False input:0 layer:fc act:relu out_features:2034 bias:False input:1 layer:fc act:relu out_features:426 bias:False input:2 layer:fc act:linear out_features:1942 bias:False input:3 layer:fc act:relu out_features:2034 bias:False input:4 layer:fc act:linear out_features:335 bias:False input:5 layer:fc act:linear out_features:1492 bias:False input:6 layer:fc act:linear out_features:2026 bias:False input:7 layer:fc act:relu out_features:2034 bias:False input:8 layer:fc act:relu out_features:1023 bias:True input:9 layer:fc act:relu out_features:1747 bias:False input:10 layer:fc act:relu out_features:1884 bias:False input:11 layer:fc act:relu out_features:2034 bias:False input:12 layer:fc act:sigmoid out_features:482 bias:False input:13 layer:fc act:sigmoid out_features:1115 bias:False input:14 layer:fc act:linear out_features:1492 bias:False input:15 layer:fc act:relu out_features:2034 bias:False input:16 layer:fc act:sigmoid out_features:505 bias:False input:17 layer:fc act:linear out_features:1659 bias:False input:18 layer:fc act:softmax out_features:10 bias:True input:19 {custom_learning}"
    # evozero_model3_gen149_classification_only_opt = f"layer:fc act:linear out_features:181 bias:True input:-1 layer:fc act:linear out_features:1942 bias:False input:0 layer:fc act:relu out_features:2034 bias:False input:1 layer:fc act:relu out_features:426 bias:False input:2 layer:fc act:linear out_features:1942 bias:False input:3 layer:fc act:relu out_features:2034 bias:False input:4 layer:fc act:linear out_features:335 bias:False input:5 layer:fc act:linear out_features:1492 bias:False input:6 layer:fc act:linear out_features:2026 bias:False input:7 layer:fc act:relu out_features:2034 bias:False input:8 layer:fc act:relu out_features:1023 bias:True input:9 layer:fc act:relu out_features:1747 bias:False input:10 layer:fc act:relu out_features:1884 bias:False input:11 layer:fc act:relu out_features:2034 bias:False input:12 layer:fc act:sigmoid out_features:482 bias:False input:13 layer:fc act:sigmoid out_features:1115 bias:False input:14 layer:fc act:linear out_features:1492 bias:False input:15 layer:fc act:relu out_features:2034 bias:False input:16 layer:fc act:sigmoid out_features:505 bias:False input:17 layer:fc act:linear out_features:1659 bias:False input:18 layer:fc act:softmax out_features:10 bias:True input:19 {nats_bench_learning}"
    energize_evozero_seed = "layer:conv out_channels:169 kernel_size:3 stride:2 padding:same act:relu bias:False input:-1 layer:pool_avg kernel_size:4 stride:3 padding:same input:0 layer:pool_max kernel_size:3 stride:3 padding:same input:1 layer:dropout rate:0.0797373400236533 input:2 layer:pool_avg kernel_size:4 stride:2 padding:same input:3 layer:conv out_channels:179 kernel_size:2 stride:2 padding:same act:relu bias:False input:4 layer:conv out_channels:188 kernel_size:5 stride:2 padding:same act:relu bias:False input:5 layer:conv out_channels:218 kernel_size:2 stride:2 padding:same act:relu bias:False input:6 layer:dropout rate:0.4859792315628067 input:7 layer:dropout rate:0.4859792315628067 input:8 layer:fc act:softmax out_features:10 bias:True input:9 learning:gradient_descent lr:0.03951134843153739 momentum:0.8492458821935789 weight_decay:0.0006669582985552901 nesterov:True early_stop:11 batch_size:663 epochs:10000"
    energize_evozero_seed_original_opt = "layer:conv out_channels:169 kernel_size:3 stride:2 padding:same act:relu bias:False input:-1 layer:pool_avg kernel_size:4 stride:3 padding:same input:0 layer:pool_max kernel_size:3 stride:3 padding:same input:1 layer:dropout rate:0.0797373400236533 input:2 layer:pool_avg kernel_size:4 stride:2 padding:same input:3 layer:conv out_channels:179 kernel_size:2 stride:2 padding:same act:relu bias:False input:4 layer:conv out_channels:188 kernel_size:5 stride:2 padding:same act:relu bias:False input:5 layer:conv out_channels:218 kernel_size:2 stride:2 padding:same act:relu bias:False input:6 layer:dropout rate:0.4859792315628067 input:7 layer:dropout rate:0.4859792315628067 input:8 layer:fc act:softmax out_features:10 bias:True input:9 learning:gradient_descent lr:0.06038641178391602 momentum:0.7297035806442497 weight_decay:0.0005353910615587854 nesterov:True early_stop:16 batch_size:967 epochs:10000"
    energize_evozero_seed_nats_opt = f"layer:conv out_channels:169 kernel_size:3 stride:2 padding:same act:relu bias:False input:-1 layer:pool_avg kernel_size:4 stride:3 padding:same input:0 layer:pool_max kernel_size:3 stride:3 padding:same input:1 layer:dropout rate:0.0797373400236533 input:2 layer:pool_avg kernel_size:4 stride:2 padding:same input:3 layer:conv out_channels:179 kernel_size:2 stride:2 padding:same act:relu bias:False input:4 layer:conv out_channels:188 kernel_size:5 stride:2 padding:same act:relu bias:False input:5 layer:conv out_channels:218 kernel_size:2 stride:2 padding:same act:relu bias:False input:6 layer:dropout rate:0.4859792315628067 input:7 layer:dropout rate:0.4859792315628067 input:8 layer:fc act:softmax out_features:10 bias:True input:9 {nats_bench_learning}"
    energize_evozero_seed_custom_opt = f"layer:conv out_channels:169 kernel_size:3 stride:2 padding:same act:relu bias:False input:-1 layer:pool_avg kernel_size:4 stride:3 padding:same input:0 layer:pool_max kernel_size:3 stride:3 padding:same input:1 layer:dropout rate:0.0797373400236533 input:2 layer:pool_avg kernel_size:4 stride:2 padding:same input:3 layer:conv out_channels:179 kernel_size:2 stride:2 padding:same act:relu bias:False input:4 layer:conv out_channels:188 kernel_size:5 stride:2 padding:same act:relu bias:False input:5 layer:conv out_channels:218 kernel_size:2 stride:2 padding:same act:relu bias:False input:6 layer:dropout rate:0.4859792315628067 input:7 layer:dropout rate:0.4859792315628067 input:8 layer:fc act:softmax out_features:10 bias:True input:9 {custom_learning}"



    # main("energize_evozero_seed_custom_opt", energize_evozero_seed_custom_opt)
    
    # seed = "layer:conv out_channels:59 kernel_size:2 stride:1 padding:same act:relu bias:False input:-1 layer:batch_norm input:0 layer:conv out_channels:59 kernel_size:2 stride:1 padding:same act:relu bias:False input:1 layer:conv out_channels:128 kernel_size:5 stride:1 padding:same act:relu bias:True input:2 layer:conv out_channels:43 kernel_size:2 stride:2 padding:same act:sigmoid bias:True input:3 layer:batch_norm input:4 layer:pool_avg kernel_size:3 stride:2 padding:same input:5 layer:batch_norm input:6 | layer:dropout rate:0.4925838587129691 input:7 layer:fc act:relu out_features:1375 bias:True input:8 layer:fc act:linear out_features:1739 bias:False input:9 layer:fc act:softmax out_features:10 bias:True input:10 learning:gradient_descent lr:0.06038641178391602 momentum:0.7297035806442497 weight_decay:0.0005353910615587854 nesterov:True early_stop:16 batch_size:967 epochs:10000"

    # main("seed_original", seed)
    
    
    # one_epoch = "layer:batch_norm input:-1 layer:fc act:softmax out_features:10 bias:True input:0 learning:gradient_descent lr:0.062839245621411 momentum:0.74693691179218 weight_decay:0.0007366696844020745 nesterov:True early_stop:17 batch_size:213 epochs:1 model_partition:_ partition_point:0"
    
    # evozero_hybrid = "layer:conv out_channels:197 kernel_size:5 stride:2 padding:same act:sigmoid bias:False input:-1 layer:conv out_channels:245 kernel_size:2 stride:3 padding:same act:relu bias:False input:0 layer:pool_avg kernel_size:3 stride:1 padding:same input:1 layer:pool_avg kernel_size:5 stride:1 padding:valid input:2 layer:pool_avg kernel_size:2 stride:1 padding:valid input:3 layer:pool_max kernel_size:3 stride:3 padding:valid input:4 layer:batch_norm input:5 layer:dropout rate:0.06639099205220429 input:6 layer:fc act:softmax out_features:10 bias:True input:7 learning:lars lr_weights:0.16220176275291953 lr_biases:0.00786004796043884 momentum:0.826844209651942 weight_decay:7.2807353463795314e-06 early_stop:9 batch_size:110 epochs:10000"
    # evozero_hybrid_nats_opt = f"layer:conv out_channels:197 kernel_size:5 stride:2 padding:same act:sigmoid bias:False input:-1 layer:conv out_channels:245 kernel_size:2 stride:3 padding:same act:relu bias:False input:0 layer:pool_avg kernel_size:3 stride:1 padding:same input:1 layer:pool_avg kernel_size:5 stride:1 padding:valid input:2 layer:pool_avg kernel_size:2 stride:1 padding:valid input:3 layer:pool_max kernel_size:3 stride:3 padding:valid input:4 layer:batch_norm input:5 layer:dropout rate:0.06639099205220429 input:6 layer:fc act:softmax out_features:10 bias:True input:7 {nats_bench_learning}"
    # evozero_hybrid_custom_opt = f"layer:conv out_channels:197 kernel_size:5 stride:2 padding:same act:sigmoid bias:False input:-1 layer:conv out_channels:245 kernel_size:2 stride:3 padding:same act:relu bias:False input:0 layer:pool_avg kernel_size:3 stride:1 padding:same input:1 layer:pool_avg kernel_size:5 stride:1 padding:valid input:2 layer:pool_avg kernel_size:2 stride:1 padding:valid input:3 layer:pool_max kernel_size:3 stride:3 padding:valid input:4 layer:batch_norm input:5 layer:dropout rate:0.06639099205220429 input:6 layer:fc act:softmax out_features:10 bias:True input:7 {custom_learning}"

    # zico = "layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:-1 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:0 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:1 layer:conv out_channels:198 kernel_size:3 stride:3 padding:same act:sigmoid bias:True input:2 layer:pool_max kernel_size:2 stride:1 padding:same input:3 layer:pool_avg kernel_size:2 stride:1 padding:same input:4 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:5 layer:batch_norm input:6 layer:conv out_channels:41 kernel_size:5 stride:2 padding:same act:relu bias:False input:7 layer:conv out_channels:94 kernel_size:2 stride:1 padding:valid act:relu bias:False input:8 layer:conv out_channels:62 kernel_size:4 stride:3 padding:valid act:sigmoid bias:False input:9 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:10 layer:pool_max kernel_size:4 stride:1 padding:same input:11 layer:conv out_channels:104 kernel_size:5 stride:1 padding:same act:relu bias:False input:12 layer:conv out_channels:95 kernel_size:3 stride:3 padding:valid act:linear bias:True input:13 layer:conv out_channels:143 kernel_size:5 stride:3 padding:same act:relu bias:True input:14 layer:fc act:sigmoid out_features:1781 bias:True input:15 layer:fc act:sigmoid out_features:826 bias:False input:16 layer:fc act:linear out_features:621 bias:False input:17 layer:fc act:relu out_features:1037 bias:True input:18 layer:fc act:relu out_features:403 bias:True input:19 layer:fc act:linear out_features:1910 bias:False input:20 layer:fc act:sigmoid out_features:1457 bias:True input:21 layer:fc act:relu out_features:1719 bias:True input:22 layer:fc act:linear out_features:1786 bias:True input:23 layer:fc act:relu out_features:1509 bias:True input:24 layer:fc act:relu out_features:1574 bias:True input:25 layer:fc act:relu out_features:711 bias:False input:26 layer:fc act:linear out_features:1910 bias:False input:27 layer:fc act:relu out_features:1948 bias:True input:28 layer:fc act:linear out_features:1337 bias:True input:29 layer:fc act:sigmoid out_features:1731 bias:True input:30 layer:fc act:linear out_features:1133 bias:False input:31 layer:fc act:linear out_features:1978 bias:False input:32 layer:fc act:linear out_features:1810 bias:False input:33 layer:fc act:relu out_features:248 bias:True input:34 layer:fc act:linear out_features:135 bias:False input:35 layer:fc act:linear out_features:1810 bias:False input:36 layer:fc act:sigmoid out_features:246 bias:False input:37 layer:fc act:linear out_features:1786 bias:True input:38 layer:fc act:linear out_features:1910 bias:False input:39 layer:fc act:relu out_features:576 bias:True input:40 layer:fc act:relu out_features:1105 bias:True input:41 layer:fc act:linear out_features:775 bias:False input:42 layer:fc act:linear out_features:1133 bias:False input:43 layer:fc act:sigmoid out_features:1457 bias:True input:44 layer:fc act:linear out_features:1978 bias:False input:45 layer:dropout rate:0.35618540891733547 input:46 layer:fc act:relu out_features:586 bias:False input:47 layer:fc act:linear out_features:1133 bias:False input:48 layer:fc act:relu out_features:966 bias:False input:49 layer:fc act:relu out_features:1287 bias:False input:50 layer:fc act:relu out_features:1494 bias:False input:51 layer:fc act:linear out_features:1910 bias:False input:52 layer:fc act:linear out_features:2001 bias:False input:53 layer:fc act:softmax out_features:10 bias:True input:54 learning:lars lr_weights:0.10980673714011889 lr_biases:0.004226997711804417 momentum:0.8211782084624883 weight_decay:8.708538191733948e-06 early_stop:18 batch_size:85 epochs:10000"
    # zico_nats_opt = f"layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:-1 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:0 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:1 layer:conv out_channels:198 kernel_size:3 stride:3 padding:same act:sigmoid bias:True input:2 layer:pool_max kernel_size:2 stride:1 padding:same input:3 layer:pool_avg kernel_size:2 stride:1 padding:same input:4 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:5 layer:batch_norm input:6 layer:conv out_channels:41 kernel_size:5 stride:2 padding:same act:relu bias:False input:7 layer:conv out_channels:94 kernel_size:2 stride:1 padding:valid act:relu bias:False input:8 layer:conv out_channels:62 kernel_size:4 stride:3 padding:valid act:sigmoid bias:False input:9 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:10 layer:pool_max kernel_size:4 stride:1 padding:same input:11 layer:conv out_channels:104 kernel_size:5 stride:1 padding:same act:relu bias:False input:12 layer:conv out_channels:95 kernel_size:3 stride:3 padding:valid act:linear bias:True input:13 layer:conv out_channels:143 kernel_size:5 stride:3 padding:same act:relu bias:True input:14 layer:fc act:sigmoid out_features:1781 bias:True input:15 layer:fc act:sigmoid out_features:826 bias:False input:16 layer:fc act:linear out_features:621 bias:False input:17 layer:fc act:relu out_features:1037 bias:True input:18 layer:fc act:relu out_features:403 bias:True input:19 layer:fc act:linear out_features:1910 bias:False input:20 layer:fc act:sigmoid out_features:1457 bias:True input:21 layer:fc act:relu out_features:1719 bias:True input:22 layer:fc act:linear out_features:1786 bias:True input:23 layer:fc act:relu out_features:1509 bias:True input:24 layer:fc act:relu out_features:1574 bias:True input:25 layer:fc act:relu out_features:711 bias:False input:26 layer:fc act:linear out_features:1910 bias:False input:27 layer:fc act:relu out_features:1948 bias:True input:28 layer:fc act:linear out_features:1337 bias:True input:29 layer:fc act:sigmoid out_features:1731 bias:True input:30 layer:fc act:linear out_features:1133 bias:False input:31 layer:fc act:linear out_features:1978 bias:False input:32 layer:fc act:linear out_features:1810 bias:False input:33 layer:fc act:relu out_features:248 bias:True input:34 layer:fc act:linear out_features:135 bias:False input:35 layer:fc act:linear out_features:1810 bias:False input:36 layer:fc act:sigmoid out_features:246 bias:False input:37 layer:fc act:linear out_features:1786 bias:True input:38 layer:fc act:linear out_features:1910 bias:False input:39 layer:fc act:relu out_features:576 bias:True input:40 layer:fc act:relu out_features:1105 bias:True input:41 layer:fc act:linear out_features:775 bias:False input:42 layer:fc act:linear out_features:1133 bias:False input:43 layer:fc act:sigmoid out_features:1457 bias:True input:44 layer:fc act:linear out_features:1978 bias:False input:45 layer:dropout rate:0.35618540891733547 input:46 layer:fc act:relu out_features:586 bias:False input:47 layer:fc act:linear out_features:1133 bias:False input:48 layer:fc act:relu out_features:966 bias:False input:49 layer:fc act:relu out_features:1287 bias:False input:50 layer:fc act:relu out_features:1494 bias:False input:51 layer:fc act:linear out_features:1910 bias:False input:52 layer:fc act:linear out_features:2001 bias:False input:53 layer:fc act:softmax out_features:10 bias:True input:54 {nats_bench_learning}"
    # zico_custom_opt = f"layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:-1 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:0 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:1 layer:conv out_channels:198 kernel_size:3 stride:3 padding:same act:sigmoid bias:True input:2 layer:pool_max kernel_size:2 stride:1 padding:same input:3 layer:pool_avg kernel_size:2 stride:1 padding:same input:4 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:5 layer:batch_norm input:6 layer:conv out_channels:41 kernel_size:5 stride:2 padding:same act:relu bias:False input:7 layer:conv out_channels:94 kernel_size:2 stride:1 padding:valid act:relu bias:False input:8 layer:conv out_channels:62 kernel_size:4 stride:3 padding:valid act:sigmoid bias:False input:9 layer:conv out_channels:157 kernel_size:5 stride:1 padding:same act:linear bias:False input:10 layer:pool_max kernel_size:4 stride:1 padding:same input:11 layer:conv out_channels:104 kernel_size:5 stride:1 padding:same act:relu bias:False input:12 layer:conv out_channels:95 kernel_size:3 stride:3 padding:valid act:linear bias:True input:13 layer:conv out_channels:143 kernel_size:5 stride:3 padding:same act:relu bias:True input:14 layer:fc act:sigmoid out_features:1781 bias:True input:15 layer:fc act:sigmoid out_features:826 bias:False input:16 layer:fc act:linear out_features:621 bias:False input:17 layer:fc act:relu out_features:1037 bias:True input:18 layer:fc act:relu out_features:403 bias:True input:19 layer:fc act:linear out_features:1910 bias:False input:20 layer:fc act:sigmoid out_features:1457 bias:True input:21 layer:fc act:relu out_features:1719 bias:True input:22 layer:fc act:linear out_features:1786 bias:True input:23 layer:fc act:relu out_features:1509 bias:True input:24 layer:fc act:relu out_features:1574 bias:True input:25 layer:fc act:relu out_features:711 bias:False input:26 layer:fc act:linear out_features:1910 bias:False input:27 layer:fc act:relu out_features:1948 bias:True input:28 layer:fc act:linear out_features:1337 bias:True input:29 layer:fc act:sigmoid out_features:1731 bias:True input:30 layer:fc act:linear out_features:1133 bias:False input:31 layer:fc act:linear out_features:1978 bias:False input:32 layer:fc act:linear out_features:1810 bias:False input:33 layer:fc act:relu out_features:248 bias:True input:34 layer:fc act:linear out_features:135 bias:False input:35 layer:fc act:linear out_features:1810 bias:False input:36 layer:fc act:sigmoid out_features:246 bias:False input:37 layer:fc act:linear out_features:1786 bias:True input:38 layer:fc act:linear out_features:1910 bias:False input:39 layer:fc act:relu out_features:576 bias:True input:40 layer:fc act:relu out_features:1105 bias:True input:41 layer:fc act:linear out_features:775 bias:False input:42 layer:fc act:linear out_features:1133 bias:False input:43 layer:fc act:sigmoid out_features:1457 bias:True input:44 layer:fc act:linear out_features:1978 bias:False input:45 layer:dropout rate:0.35618540891733547 input:46 layer:fc act:relu out_features:586 bias:False input:47 layer:fc act:linear out_features:1133 bias:False input:48 layer:fc act:relu out_features:966 bias:False input:49 layer:fc act:relu out_features:1287 bias:False input:50 layer:fc act:relu out_features:1494 bias:False input:51 layer:fc act:linear out_features:1910 bias:False input:52 layer:fc act:linear out_features:2001 bias:False input:53 layer:fc act:softmax out_features:10 bias:True input:54 {custom_learning}"
    
    zico_hybrid = "layer:conv out_channels:115 kernel_size:5 stride:2 padding:same act:sigmoid bias:True input:-1 layer:conv out_channels:252 kernel_size:5 stride:1 padding:same act:sigmoid bias:False input:0 layer:conv out_channels:220 kernel_size:2 stride:1 padding:valid act:relu bias:True input:1 layer:conv out_channels:182 kernel_size:5 stride:3 padding:same act:relu bias:False input:2 layer:batch_norm input:3 layer:conv out_channels:61 kernel_size:4 stride:3 padding:same act:sigmoid bias:False input:4 layer:pool_avg kernel_size:4 stride:1 padding:valid input:5 layer:pool_max kernel_size:5 stride:1 padding:same input:6 layer:conv out_channels:101 kernel_size:3 stride:1 padding:valid act:linear bias:False input:7 layer:conv out_channels:240 kernel_size:5 stride:1 padding:same act:linear bias:True input:8 layer:dropout rate:0.38101517571044946 input:9 layer:conv out_channels:252 kernel_size:5 stride:1 padding:same act:sigmoid bias:False input:10 layer:conv out_channels:227 kernel_size:4 stride:3 padding:same act:linear bias:False input:11 layer:conv out_channels:156 kernel_size:5 stride:3 padding:valid act:relu bias:True input:12 layer:fc act:linear out_features:796 bias:False input:13 layer:fc act:relu out_features:998 bias:False input:14 layer:fc act:linear out_features:1503 bias:True input:15 layer:fc act:sigmoid out_features:1764 bias:False input:16 layer:fc act:relu out_features:1445 bias:False input:17 layer:fc act:relu out_features:803 bias:False input:18 layer:fc act:sigmoid out_features:1646 bias:False input:19 layer:fc act:sigmoid out_features:1764 bias:False input:20 layer:fc act:relu out_features:803 bias:False input:21 layer:fc act:linear out_features:2002 bias:True input:22 layer:fc act:sigmoid out_features:1596 bias:True input:23 layer:fc act:relu out_features:1639 bias:True input:24 layer:dropout rate:0.026878465864389932 input:25 layer:fc act:sigmoid out_features:1598 bias:False input:26 layer:dropout rate:0.4564280818890324 input:27 layer:fc act:linear out_features:1503 bias:True input:28 layer:fc act:linear out_features:1473 bias:False input:29 layer:fc act:linear out_features:1533 bias:False input:30 layer:fc act:linear out_features:937 bias:True input:31 layer:fc act:relu out_features:1956 bias:False input:32 layer:dropout rate:0.4643883652353804 input:33 layer:fc act:relu out_features:314 bias:False input:34 layer:fc act:sigmoid out_features:1043 bias:True input:35 layer:fc act:linear out_features:1503 bias:True input:36 layer:fc act:linear out_features:1503 bias:True input:37 layer:fc act:relu out_features:1801 bias:False input:38 layer:fc act:linear out_features:1735 bias:True input:39 layer:fc act:relu out_features:1963 bias:True input:40 layer:fc act:linear out_features:1503 bias:True input:41 layer:fc act:linear out_features:1503 bias:True input:42 layer:fc act:sigmoid out_features:987 bias:True input:43 layer:fc act:sigmoid out_features:1769 bias:False input:44 layer:fc act:relu out_features:517 bias:True input:45 layer:fc act:sigmoid out_features:990 bias:True input:46 layer:fc act:linear out_features:1947 bias:False input:47 layer:fc act:linear out_features:329 bias:False input:48 layer:fc act:softmax out_features:10 bias:True input:49 learning:gradient_descent lr:0.01376037794057456 momentum:0.7919995942623916 weight_decay:0.0008022029605492841 nesterov:True early_stop:9 batch_size:817 epochs:10000"
    zico_hybrid_nats_opt = f"layer:conv out_channels:115 kernel_size:5 stride:2 padding:same act:sigmoid bias:True input:-1 layer:conv out_channels:252 kernel_size:5 stride:1 padding:same act:sigmoid bias:False input:0 layer:conv out_channels:220 kernel_size:2 stride:1 padding:valid act:relu bias:True input:1 layer:conv out_channels:182 kernel_size:5 stride:3 padding:same act:relu bias:False input:2 layer:batch_norm input:3 layer:conv out_channels:61 kernel_size:4 stride:3 padding:same act:sigmoid bias:False input:4 layer:pool_avg kernel_size:4 stride:1 padding:valid input:5 layer:pool_max kernel_size:5 stride:1 padding:same input:6 layer:conv out_channels:101 kernel_size:3 stride:1 padding:valid act:linear bias:False input:7 layer:conv out_channels:240 kernel_size:5 stride:1 padding:same act:linear bias:True input:8 layer:dropout rate:0.38101517571044946 input:9 layer:conv out_channels:252 kernel_size:5 stride:1 padding:same act:sigmoid bias:False input:10 layer:conv out_channels:227 kernel_size:4 stride:3 padding:same act:linear bias:False input:11 layer:conv out_channels:156 kernel_size:5 stride:3 padding:valid act:relu bias:True input:12 layer:fc act:linear out_features:796 bias:False input:13 layer:fc act:relu out_features:998 bias:False input:14 layer:fc act:linear out_features:1503 bias:True input:15 layer:fc act:sigmoid out_features:1764 bias:False input:16 layer:fc act:relu out_features:1445 bias:False input:17 layer:fc act:relu out_features:803 bias:False input:18 layer:fc act:sigmoid out_features:1646 bias:False input:19 layer:fc act:sigmoid out_features:1764 bias:False input:20 layer:fc act:relu out_features:803 bias:False input:21 layer:fc act:linear out_features:2002 bias:True input:22 layer:fc act:sigmoid out_features:1596 bias:True input:23 layer:fc act:relu out_features:1639 bias:True input:24 layer:dropout rate:0.026878465864389932 input:25 layer:fc act:sigmoid out_features:1598 bias:False input:26 layer:dropout rate:0.4564280818890324 input:27 layer:fc act:linear out_features:1503 bias:True input:28 layer:fc act:linear out_features:1473 bias:False input:29 layer:fc act:linear out_features:1533 bias:False input:30 layer:fc act:linear out_features:937 bias:True input:31 layer:fc act:relu out_features:1956 bias:False input:32 layer:dropout rate:0.4643883652353804 input:33 layer:fc act:relu out_features:314 bias:False input:34 layer:fc act:sigmoid out_features:1043 bias:True input:35 layer:fc act:linear out_features:1503 bias:True input:36 layer:fc act:linear out_features:1503 bias:True input:37 layer:fc act:relu out_features:1801 bias:False input:38 layer:fc act:linear out_features:1735 bias:True input:39 layer:fc act:relu out_features:1963 bias:True input:40 layer:fc act:linear out_features:1503 bias:True input:41 layer:fc act:linear out_features:1503 bias:True input:42 layer:fc act:sigmoid out_features:987 bias:True input:43 layer:fc act:sigmoid out_features:1769 bias:False input:44 layer:fc act:relu out_features:517 bias:True input:45 layer:fc act:sigmoid out_features:990 bias:True input:46 layer:fc act:linear out_features:1947 bias:False input:47 layer:fc act:linear out_features:329 bias:False input:48 layer:fc act:softmax out_features:10 bias:True input:49 {nats_bench_learning}"
    zico_hybrid_custom_opt = f"layer:conv out_channels:115 kernel_size:5 stride:2 padding:same act:sigmoid bias:True input:-1 layer:conv out_channels:252 kernel_size:5 stride:1 padding:same act:sigmoid bias:False input:0 layer:conv out_channels:220 kernel_size:2 stride:1 padding:valid act:relu bias:True input:1 layer:conv out_channels:182 kernel_size:5 stride:3 padding:same act:relu bias:False input:2 layer:batch_norm input:3 layer:conv out_channels:61 kernel_size:4 stride:3 padding:same act:sigmoid bias:False input:4 layer:pool_avg kernel_size:4 stride:1 padding:valid input:5 layer:pool_max kernel_size:5 stride:1 padding:same input:6 layer:conv out_channels:101 kernel_size:3 stride:1 padding:valid act:linear bias:False input:7 layer:conv out_channels:240 kernel_size:5 stride:1 padding:same act:linear bias:True input:8 layer:dropout rate:0.38101517571044946 input:9 layer:conv out_channels:252 kernel_size:5 stride:1 padding:same act:sigmoid bias:False input:10 layer:conv out_channels:227 kernel_size:4 stride:3 padding:same act:linear bias:False input:11 layer:conv out_channels:156 kernel_size:5 stride:3 padding:valid act:relu bias:True input:12 layer:fc act:linear out_features:796 bias:False input:13 layer:fc act:relu out_features:998 bias:False input:14 layer:fc act:linear out_features:1503 bias:True input:15 layer:fc act:sigmoid out_features:1764 bias:False input:16 layer:fc act:relu out_features:1445 bias:False input:17 layer:fc act:relu out_features:803 bias:False input:18 layer:fc act:sigmoid out_features:1646 bias:False input:19 layer:fc act:sigmoid out_features:1764 bias:False input:20 layer:fc act:relu out_features:803 bias:False input:21 layer:fc act:linear out_features:2002 bias:True input:22 layer:fc act:sigmoid out_features:1596 bias:True input:23 layer:fc act:relu out_features:1639 bias:True input:24 layer:dropout rate:0.026878465864389932 input:25 layer:fc act:sigmoid out_features:1598 bias:False input:26 layer:dropout rate:0.4564280818890324 input:27 layer:fc act:linear out_features:1503 bias:True input:28 layer:fc act:linear out_features:1473 bias:False input:29 layer:fc act:linear out_features:1533 bias:False input:30 layer:fc act:linear out_features:937 bias:True input:31 layer:fc act:relu out_features:1956 bias:False input:32 layer:dropout rate:0.4643883652353804 input:33 layer:fc act:relu out_features:314 bias:False input:34 layer:fc act:sigmoid out_features:1043 bias:True input:35 layer:fc act:linear out_features:1503 bias:True input:36 layer:fc act:linear out_features:1503 bias:True input:37 layer:fc act:relu out_features:1801 bias:False input:38 layer:fc act:linear out_features:1735 bias:True input:39 layer:fc act:relu out_features:1963 bias:True input:40 layer:fc act:linear out_features:1503 bias:True input:41 layer:fc act:linear out_features:1503 bias:True input:42 layer:fc act:sigmoid out_features:987 bias:True input:43 layer:fc act:sigmoid out_features:1769 bias:False input:44 layer:fc act:relu out_features:517 bias:True input:45 layer:fc act:sigmoid out_features:990 bias:True input:46 layer:fc act:linear out_features:1947 bias:False input:47 layer:fc act:linear out_features:329 bias:False input:48 layer:fc act:softmax out_features:10 bias:True input:49 {custom_learning}"

    main("zico_hybrid", zico_hybrid)
    main("zico_hybrid_nats_opt", zico_hybrid_nats_opt)
    main("zico_hybrid_custom_opt", zico_hybrid_custom_opt)
